<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Central Fuel Plan Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Login Page -->
    <div id="loginPage" class="login-page">
      <div class="login-wrapper">
        <!-- Hero Section -->
        <div class="login-hero">
          <div class="login-hero-content">
            <img
              src="https://cdn.builder.io/api/v1/image/assets%2Fbd65b3cd7a86452e803a3d7dc7a3d048%2F4650ac9d8ec64a8d9e2c7a3167752a4f?format=webp&width=800"
              alt="ACES MSD Logo"
              class="login-logo"
            />
            <div class="login-title"><p>ACES MSD - Fuel Plan Dashboard</p></div>
          </div>
        </div>

        <!-- Login Section -->
        <div class="login-section">
          <div class="login-form-container">
            <h2 class="login-form-title">Welcome Back</h2>
            <p class="login-form-subtitle">Sign in to continue</p>
            <form class="login-form" id="loginForm" autocomplete="off">
              <div class="form-group">
                <label for="username" class="form-label">Username</label>
                <input
                  type="text"
                  id="username"
                  name="username"
                  class="form-input"
                  placeholder="Enter your username"
                  autocomplete="username"
                  required
                />
              </div>
              <div class="form-group">
                <label for="password" class="form-label">Password</label>
                <input
                  type="password"
                  id="password"
                  name="password"
                  class="form-input"
                  placeholder="Enter your password"
                  autocomplete="current-password"
                  required
                />
              </div>
              <button type="submit" class="login-button">Sign In</button>
              <p class="login-error" id="loginError" style="display: none"></p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Analytics Page -->
    <div id="analyticsPage" class="analytics-page" style="display: none">
      <div class="analytics-header">
        <h1>Fuel Analytics & Impact Analysis</h1>
      </div>
      <div class="analytics-container">
        <div class="analytics-card due-sites-card">
          <h2>Due Sites</h2>
          <div class="analytics-stat">
            <div class="stat-value" id="dueSitesCount">0</div>
            <div class="stat-label">Total Due</div>
          </div>
          <div id="dueSitesBreakdown" class="breakdown"></div>
        </div>

        <div class="analytics-card fuel-impact-card">
          <h2>Fuel Impact</h2>
          <div class="analytics-stat">
            <div class="stat-value" id="affectedSitesCount">0</div>
            <div class="stat-label">Sites Affected</div>
          </div>
          <div id="impactBreakdown" class="breakdown"></div>
        </div>

        <div class="analytics-card violations-card">
          <h2>Violations Due to Fuel</h2>
          <div class="analytics-stat">
            <div class="stat-value" id="violationsCount">0</div>
            <div class="stat-label">Total Violations</div>
          </div>
          <div id="violationsBreakdown" class="breakdown"></div>
        </div>

        <div class="analytics-card sites-down-card">
          <h2>Sites Down Due to Fuel</h2>
          <div class="analytics-stat">
            <div class="stat-value" id="sitesDownCount">0</div>
            <div class="stat-label">Non-Operational</div>
          </div>
          <div id="sitesDownList" class="breakdown"></div>
        </div>
      </div>

      <div class="analytics-details">
        <h3>Detailed Due Sites List</h3>
        <table class="analytics-table">
          <thead>
            <tr>
              <th>Site Name</th>
              <th>Fueling Date</th>
              <th>Days Overdue</th>
              <th>Impact Level</th>
            </tr>
          </thead>
          <tbody id="dueDetailsList"></tbody>
        </table>
      </div>
    </div>

    <div class="dashboard" id="dashboardPage" style="display: none">
      <div class="dashboard-header">
        <div class="header-content">
          <div class="logo-text logo-left">Managed Services Dept.</div>
          <h1 class="header-title">stc COW CER FUEL PLAN DASHBOARD</h1>
          <div class="header-right">
            <img
              src="https://cdn.builder.io/api/v1/image/assets%2Fbd65b3cd7a86452e803a3d7dc7a3d048%2F2a2ac0238b1444ef9a1b89619ad94b40?format=webp&width=400"
              alt="ACES Managed Services Logo"
              class="logo"
            />
            <button class="logout-btn" onclick="handleLogout()">Logout</button>
          </div>
        </div>
      </div>
      <div class="region-tabs">
        <button class="region-tab" onclick="selectRegion('Central')">
          Central Region
        </button>
        <button class="region-tab" onclick="selectRegion('East')">
          East Region
        </button>
        <button class="region-tab active" onclick="selectRegion('CER')">
          CER (Central & East)
        </button>
      </div>
      <div class="date-section">
        <div id="headerDate" class="header-date"></div>
        <div class="event-cards" id="eventCardsContainer">
          <div class="event-card vvvip-card" onclick="showVVVIPModal()">
            <div class="event-card-label">Royal, MOI & Winter Camps</div>
            <div class="event-card-count" id="vvvipCount">0</div>
          </div>
        </div>
      </div>
      <div class="left-panel">
        <div class="search-bar-container">
          <input
            type="text"
            id="searchInput"
            class="search-bar"
            placeholder="Search by Site Name..."
          />
          <button
            id="downloadBtn"
            class="download-btn"
            onclick="downloadExcel()"
          >
            ðŸ“¥ Download Excel
          </button>
          <button
            id="invoiceBtn"
            class="invoice-btn"
            onclick="openInvoiceModal()"
          >
            ðŸ“Š Manage Invoice
          </button>
        </div>

        <div class="metrics-grid">
          <div class="metric-box">
            <div class="metric-label">Total Sites</div>
            <div class="metric-value" id="totalSites">0</div>
          </div>
          <div class="metric-box">
            <div class="metric-label">Due (Overdue)</div>
            <div class="metric-value due" id="dueSites">0</div>
          </div>
          <div class="metric-box">
            <div class="metric-label">Today</div>
            <div class="metric-value today-metric" id="todaySites">0</div>
          </div>
          <div class="metric-box">
            <div class="metric-label">Next 3-15 Days</div>
            <div class="metric-value future" id="futureSites">0</div>
          </div>
        </div>

        <div class="kpi-card">
          <p class="kpi-title"><strong>Fueling Performance KPI</strong></p>
          <div class="kpi-chart-container">
            <canvas id="kpiChart"></canvas>
            <div class="kpi-percentage" id="kpiPercentage">0%</div>
          </div>
          <p class="kpi-description">On-time fuel compliance rate</p>
        </div>

        <div class="cards-container">
          <div class="status-card overdue-card">
            <h3>Due (Overdue)</h3>
            <table class="sites-table">
              <thead>
                <tr>
                  <th>Site Name</th>
                  <th>Next Fueling Plan</th>
                </tr>
              </thead>
              <tbody id="overdueTableBody"></tbody>
            </table>
          </div>

          <div class="status-card today-card">
            <h3>Today Schedule</h3>
            <table class="sites-table">
              <thead>
                <tr>
                  <th>Site Name</th>
                  <th>Next Fueling Plan</th>
                </tr>
              </thead>
              <tbody id="todayTableBody"></tbody>
            </table>
          </div>

          <div class="status-card coming-card">
            <h3>
              Coming in 3 Days
              <span id="comingSummary" class="coming-summary"></span>
            </h3>
            <table class="sites-table">
              <thead>
                <tr>
                  <th>Site Name</th>
                  <th>Days</th>
                </tr>
              </thead>
              <tbody id="comingTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="right-panel">
        <h2 class="map-title">Live stc COW Fuel status</h2>
        <div id="map" class="map-container"></div>
      </div>
    </div>

    <div id="searchModal" class="search-modal">
      <div class="search-modal-content">
        <button class="search-modal-close" onclick="closeSearchModal()">
          &times;
        </button>
        <div id="searchResult" class="search-result">
          <!-- Results displayed here -->
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="script.js"></script>

    <!-- VVVIP Modal -->
    <div id="vvvipModal" class="modal">
      <div class="modal-content vvvip-modal-content">
        <div class="modal-header">
          <img
            src="https://cdn.builder.io/api/v1/image/assets%2Fbd65b3cd7a86452e803a3d7dc7a3d048%2F57031e60664c427787ec8c6ca072dfb6?format=webp&width=800"
            alt="VVVIP Logo"
            class="stc-logo"
          />
          <h2>Royal, MOI & Winter Camps</h2>
          <button class="modal-close" onclick="closeVVVIPModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <table class="vvvip-table">
            <thead>
              <tr>
                <th>Site Name</th>
                <th>Next Fueling Plan</th>
                <th>Site Label</th>
              </tr>
            </thead>
            <tbody id="vvvipTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Fuel Quantity Invoice Modal -->
    <div id="invoiceModal" class="modal">
      <div class="modal-content invoice-modal-content">
        <div class="modal-header">
          <h2>Fuel Quantity Management & Invoice</h2>
          <button class="modal-close" onclick="closeInvoiceModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div class="invoice-container">
            <!-- Date Range Filter Section -->
            <div class="invoice-section">
              <h3>Download Invoice by Date Range</h3>
              <div class="date-range-filter">
                <div class="date-input-group">
                  <label for="invoiceStartDate">Start Date:</label>
                  <input
                    type="date"
                    id="invoiceStartDate"
                    class="date-input"
                    onchange="loadInvoiceDataByDateRange()"
                  />
                </div>
                <div class="date-input-group">
                  <label for="invoiceEndDate">End Date:</label>
                  <input
                    type="date"
                    id="invoiceEndDate"
                    class="date-input"
                    onchange="loadInvoiceDataByDateRange()"
                  />
                </div>
                <div class="date-input-group">
                  <label for="invoiceRegion">Region:</label>
                  <select id="invoiceRegion" class="date-input" onchange="loadInvoiceDataByDateRange()">
                    <option value="">-- All Regions --</option>
                    <option value="Central">Central</option>
                    <option value="East">East</option>
                    <option value="CER">CER (Central & East)</option>
                  </select>
                </div>
                <button
                  class="download-invoice-btn"
                  onclick="downloadInvoiceByDateRange()"
                >
                  ðŸ“¥ Download Invoice
                </button>
              </div>
              <div id="invoiceStatus" class="invoice-status"></div>
            </div>

            <!-- Preview Section -->
            <div class="invoice-section">
              <h3>Fuel Records</h3>
              <div id="invoicePreview" class="invoice-preview">
                <table class="invoice-table">
                  <thead>
                    <tr>
                      <th>Site Name</th>
                      <th>Region</th>
                      <th>Refilled Date</th>
                      <th>Refilled Quantity</th>
                    </tr>
                  </thead>
                  <tbody id="invoicePreviewBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </body>
</html>
